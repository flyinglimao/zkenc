# zkenc-cli

Command-line interface for zkenc witness encryption with Circom circuit support.

## Installation

````bash
git clone https://github.com/flyinglimao/zkenc
cd zkenc/packages/zkenc-cli

### Install to PATH

```bash
cargo install --path .
````

## üìñ Usage

### Command Overview

zkenc provides four main commands for witness encryption:

1. **`encap`** - Generate ciphertext and encryption key
2. **`decap`** - Recover decryption key using witness
3. **`encrypt`** - Encrypt message with key
4. **`decrypt`** - Decrypt message with key

### Command Reference

#### `zkenc encap`

Generate ciphertext and encryption key from circuit and public inputs.

```bash
zkenc encap \
  --circuit <R1CS_FILE> \
  --input <JSON_FILE> \
  --ciphertext <OUTPUT_CT> \
  --key <OUTPUT_KEY>
```

**Arguments:**

- `-c, --circuit <FILE>` - Path to R1CS circuit file (`.r1cs` from Circom)
- `-i, --input <FILE>` - Path to JSON file with public inputs
- `-c, --ciphertext <FILE>` - Output path for ciphertext
- `-k, --key <FILE>` - Output path for encryption key

**Example:**

```bash
zkenc encap \
  -c tests/r1cs/sudoku.r1cs \
  -i tests/inputs/sudoku_basic.json \
  -c ciphertext.bin \
  -k key.bin
```

#### `zkenc decap`

Recover the encryption key using a valid witness and ciphertext.

```bash
zkenc decap \
  --circuit <R1CS_FILE> \
  --witness <WTNS_FILE> \
  --ciphertext <CT_FILE> \
  --key <OUTPUT_KEY>
```

**Arguments:**

- `-c, --circuit <FILE>` - Path to R1CS circuit file
- `-w, --witness <FILE>` - Path to witness file (`.wtns` from snarkjs)
- `-c, --ciphertext <FILE>` - Path to ciphertext file
- `-k, --key <FILE>` - Output path for recovered key

**Example:**

```bash
zkenc decap \
  -c tests/r1cs/sudoku.r1cs \
  -w tests/inputs/sudoku_sudoku_basic.wtns \
  -c ciphertext.bin \
  -k recovered_key.bin
```

#### `zkenc encrypt`

Encrypt a message using the encryption key (AES-256-GCM).

```bash
zkenc encrypt \
  --key <KEY_FILE> \
  --input <MESSAGE_FILE> \
  --output <OUTPUT_FILE>
```

**Arguments:**

- `-k, --key <FILE>` - Path to encryption key file
- `-i, --input <FILE>` - Path to plaintext message file
- `-o, --output <FILE>` - Output path for encrypted file

**Example:**

```bash
zkenc encrypt \
  -k key.bin \
  -i message.txt \
  -o encrypted.bin
```

#### `zkenc decrypt`

Decrypt a message using the decryption key.

```bash
zkenc decrypt \
  --key <KEY_FILE> \
  --input <ENCRYPTED_FILE> \
  --output <OUTPUT_FILE>
```

**Arguments:**

- `-k, --key <FILE>` - Path to decryption key file
- `-i, --input <FILE>` - Path to encrypted file
- `-o, --output <FILE>` - Output path for decrypted message

**Example:**

```bash
zkenc decrypt \
  -k recovered_key.bin \
  -i encrypted.bin \
  -o decrypted.txt
```

## üéØ Complete Workflow Example

Here's a complete example using a Sudoku circuit:

```bash
# Step 1: Generate ciphertext and key
zkenc encap \
  -c sudoku.r1cs \
  -i puzzle.json \
  -c ct.bin \
  -k key1.bin

# Step 2: Encrypt your secret message
echo "Hello, Sudoku solver!" > secret.txt
zkenc encrypt -k key1.bin -i secret.txt -o encrypted.bin

# Step 3: (Someone with valid witness) Recover the key
zkenc decap \
  -c sudoku.r1cs \
  -w solution.wtns \
  -c ct.bin \
  -k key2.bin

# Step 4: Decrypt the message
zkenc decrypt -k key2.bin -i encrypted.bin -o decrypted.txt

# Verify
cat decrypted.txt
# Output: Hello, Sudoku solver!
```

## üîß Input File Formats

### R1CS Circuit File (`.r1cs`)

Generated by Circom compiler:

```bash
circom circuit.circom --r1cs --wasm --sym
```

### Witness File (`.wtns`)

Generated by snarkjs:

```bash
# Calculate witness from input
snarkjs wtns calculate circuit.wasm input.json witness.wtns

# Verify witness (optional)
snarkjs wtns check circuit.r1cs witness.wtns
```

### Input JSON File

JSON object with public inputs (flattened in alphabetical key order):

```json
{
  "puzzle": [5, 3, 0, 0, 7, 0, ...],
  "solution": [5, 3, 4, 6, 7, 8, ...]
}
```

## üß™ Testing

Run the test suite:

```bash
# Unit tests
cargo test

# E2E integration tests
cargo test --test e2e_test

# Run specific test with output
cargo test test_sudoku_e2e -- --nocapture
```

## üìù Technical Details

### Supported Curves

- **BN254 (alt_bn128)** - Default curve used by Circom

### Encryption Algorithm

- **AES-256-GCM** - Authenticated encryption for message protection

### File Sizes

- Ciphertext: ~24KB (for 162-constraint Sudoku circuit)
- Key: 32 bytes
- Witness: Varies by circuit size

## ü§ù Contributing

Contributions are welcome! Please feel free to submit issues or pull requests.
